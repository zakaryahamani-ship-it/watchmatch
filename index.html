<script>
function parseBudget(input){
    if(input.includes("-")){
        let parts = input.split("-");
        return {min: parseInt(parts[0].trim()), max: parseInt(parts[1].trim())};
    } else {
        let value = parseInt(input.trim());
        return {min: value, max: value};
    }
}

function runQuiz(){
    const budgetInput = document.getElementById("budget").value;
    const styleInput = document.getElementById("style").value;
    const mouvInput = document.getElementById("mouvement").value;
    const usageInput = document.getElementById("usage").value;
    const poignetInput = document.getElementById("poignet").value;

    if(!budgetInput || !styleInput || !mouvInput || !usageInput){
        alert("Merci de répondre à toutes les questions obligatoires !");
        return;
    }

    const budget = parseBudget(budgetInput);

    // On attribue un score à chaque montre
    let scoredWatches = watches.map(w => {
        let score = 0;

        // Budget : score plus élevé si prix proche du milieu de la fourchette
        let budgetMid = (budget.min + budget.max) / 2;
        let diff = Math.abs(w.price - budgetMid);
        let maxDiff = budget.max - budget.min || 1;
        score += Math.max(0, 10 - 10 * (diff / maxDiff)); // entre 0 et 10

        // Style
        if(w.style === styleInput) score += 10;

        // Mouvement
        if(mouvInput === "any" || w.movement === mouvInput) score += 5;

        // Usage
        if(w.usage === usageInput) score += 5;

        // Poignet optionnel (on peut adapter plus tard)
        if(poignetInput){
            let poignet = parseFloat(poignetInput);
            if(!isNaN(poignet)){
                // Score réduit si boîtier trop grand ou petit
                // Pour simplifier ici on ignore, mais tu peux ajouter plus tard
            }
        }

        return {...w, score};
    });

    // On trie par score décroissant
    scoredWatches.sort((a,b) => b.score - a.score);

    const mainWatch = scoredWatches[0];
    const altWatch = scoredWatches[1] || scoredWatches[0];

    // Affichage
    let html = `
        <div class="watch">
            <h2>Modèle recommandé : ${mainWatch.name}</h2>
            <img src="${mainWatch.image}" alt="${mainWatch.name}">
            ${mainWatch.image3D ? `<p><a href="${mainWatch.image3D}" target="_blank">Vue 3D disponible</a></p>` : ""}
            <p>${mainWatch.note}</p>
            <p><a href="${mainWatch.link}" target="_blank">Découvrir chez la manufacture</a></p>
        </div>
        <div class="watch">
            <h2>Alternative : ${altWatch.name}</h2>
            <img src="${altWatch.image}" alt="${altWatch.name}">
            ${altWatch.image3D ? `<p><a href="${altWatch.image3D}" target="_blank">Vue 3D disponible</a></p>` : ""}
            <p>${altWatch.note}</p>
            <p><a href="${altWatch.link}" target="_blank">Découvrir chez la manufacture</a></p>
        </div>
    `;

    document.getElementById("quiz").style.display = "none";
    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = html;
}
</script>
